{% extends 'base.html.twig' %}

{% block title %} - {{trick.name}}{% endblock %}

{% block body %}
  <section class="trick">

    <div class=" container">
    	{% if not trick.media|length %}
        <img src="/pictures/trick_defaut.jpg"></img>
			{% endif %}
      {% for media in trick.media %}
          {% if media.type == 1 > 0 | slice(0,0)%}
              {% if loop.first %}
                  <img src="/pictures/images/{{media.imageName}}"></img>
              {% endif %}
{#           {% elseif media.type == 2 %} #}
          {% else %}
              <img src="/pictures/trick_defaut.jpg"></img> 
          {% endif %}
      {% endfor %} 
      {% if app.user %}
        <div class="top-right">
          <a href="{{ path('editTrick', {'slug': trick.slug}) }}">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" width="66px" height="66px" viewBox="0 -0.5 66 66" version="1.1"><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"><g id="Pencil" sketch:type="MSLayerGroup" transform="translate(2.000000, 1.000000)" stroke="#6B6C6E" stroke-width="2"><path d="M7.5,43.7 L0,62 L18.3,54.5" id="Shape" sketch:type="MSShapeGroup"/><path d="M19.4,53.9 C18.5,54.8 17.1,54.8 16.2,53.9 L17,49.9 L12.2,49.9 L12.2,45.1 L8.2,45.9 C7.3,45 7.3,43.6 8.2,42.7 L50.2,0.7 C51.1,-0.2 52.5,-0.2 53.4,0.7 L61.5,8.8 C62.4,9.7 62.4,11.1 61.5,12 L19.4,53.9 L19.4,53.9 Z" id="Shape" sketch:type="MSShapeGroup"/><path d="M12.1,45 L48.4,8.7" id="Shape" sketch:type="MSShapeGroup"/><path d="M17,49.9 L53.3,13.6" id="Shape" sketch:type="MSShapeGroup"/><path d="M45.2,5.5 L56.5,16.8" id="Shape" sketch:type="MSShapeGroup"/></g></g></svg>
          </a>
          <a href="#delete{{trick.slug}}">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" width="64px" height="64px" viewBox="-5 0 64 64" version="1.1"><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"><g id="Trash" sketch:type="MSLayerGroup" transform="translate(1.000000, 1.000000)" stroke="#6B6C6E" stroke-width="2"><path d="M48,13.8 L43.9,59.2 C43.9,60.7 42.7,62 41.1,62 L10.9,62 C9.4,62 8.1,60.8 8.1,59.2 L4,13.8" id="Shape" sketch:type="MSShapeGroup"/><path d="M8.8,13.9 L2.6,13.9 C1.2,13.9 0,12.7 0,11.3 L0,8.7 C0,7.2 1.2,6.1 2.6,6.1 L49.3,6.1 C50.7,6.1 51.9,7.3 51.9,8.7 L51.9,11.3 C51.9,12.8 50.7,13.9 49.3,13.9 L43.1,13.9" id="Shape" sketch:type="MSShapeGroup"/><path d="M25.9,19 L25.9,54" id="Shape" sketch:type="MSShapeGroup"/><path d="M14.9,19 L16.3,53.9" id="Shape" sketch:type="MSShapeGroup"/><path d="M36.9,19.1 L35.6,53.9" id="Shape" sketch:type="MSShapeGroup"/><rect id="Rectangle-path" sketch:type="MSShapeGroup" x="19" y="0" width="14" height="6"/></g></g></svg>
          </a>
          <a href="#media">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" width="64px" height="64px" viewBox="0 -7.5 64 64" version="1.1"><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"><g id="Camera" sketch:type="MSLayerGroup" transform="translate(1.000000, 1.000000)" stroke="#6B6C6E" stroke-width="2"><path d="M24,7 L27,0 L45,0 L48,7" id="Shape" sketch:type="MSShapeGroup"/><path d="M7,7 L7,3 L17,3 L17,7" id="Shape" sketch:type="MSShapeGroup"/><path d="M62,45 C62,46.1 61.1,47 60,47 L2,47 C0.9,47 0,46.1 0,45 L0,9 C0,7.9 0.9,7 2,7 L60,7 C61.1,7 62,7.9 62,9 L62,45 L62,45 Z" id="Shape" sketch:type="MSShapeGroup"/><path d="M12,16 L12,47" id="Shape" sketch:type="MSShapeGroup"/><path d="M30,4 L42,4" id="Shape" sketch:type="MSShapeGroup"/><path d="M1,15 L29,15" id="Shape" sketch:type="MSShapeGroup"/><path d="M44,15 L61,15" id="Shape" sketch:type="MSShapeGroup"/><path d="M3,11 L5,11" id="Shape" sketch:type="MSShapeGroup"/><path d="M7,11 L9,11" id="Shape" sketch:type="MSShapeGroup"/><circle id="Oval" sketch:type="MSShapeGroup" cx="36" cy="28" r="15"/><circle id="Oval" sketch:type="MSShapeGroup" cx="36" cy="28" r="11"/></g></g></svg>
          </a>   
        </div>    
      {% endif %}
      <h2 class="centered ">{{trick.name}}</h2>
    </div>
    <div class="media">
      {% for media in trick.media %}
          {% if media.type == 1 and loop.first %}
          {% elseif media.type == 1 %}
          <img src="/pictures/images/{{media.imageName}}"></img>
          {% elseif media.type == 2 %}
            <iframe
              src="https://www.youtube.com/embed/{{ media.url }}"
              title="YouTube video player"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen></iframe>
          {% endif %}
      {% endfor %}
    </div>

    <div class="card description">
      <h3>Description</h3>
      <p>{{trick.content | raw}}</p>
    </div>

    <div class="details">
      <div class="card">
        <div class="card-body">
          <h6 class="card-subtitle mb-2 text-muted">Difficulté</h6>
          <p class="card-text">
            {% if trick.category == 1 %}
              Facile
            {% endif %}
            {% if trick.category == 2 %}
              Moyen
            {% endif %}
            {% if trick.category == 3 %}
              Difficile
            {% endif %}
            {% if trick.category == 4 %}
              Mortel
            {% endif %}
          </p>
        </div>
      </div>    
      
      <div class="card">
        <div class="card-body">
          <h6 class="card-subtitle mb-2 text-muted">Création</h6>
          <p class="card-text">Le {{trick.createdAte | date('d/m/Y')}} par {{trick.CreatedUser.pseudo}}</p>
        </div>
      </div>

      {% if trick.upDating > trick.createdAte  %}
        <div class="card">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">Mise à jour</h6>
            <p class="card-text">Le {{trick.upDating | date('d/m/Y')}} par  {{trick.authorUp}} </p>
          </div>
        </div>
      {% endif %}
    </div>

    <div class="card formComment">
      {% if app.user %}
        {{ form_start(commentForm) }}
          {{ form_row(commentForm.content, {'label' : 'Votre commentaire inspiré'})}}
          <button type="submit" class="btn btn-primary">Publier</button>
        {{ form_end(commentForm) }}
      {% else %}
      <p>Pour écrire un commentaire <a href="{{ path('login') }}">connectez vous</a> !</p>
      {% endif %}
    </div>

    <div class="card comments">
      <h5>{{trick.comments | length }} commentaires</h5>
      {% for comment in trick.comments | slice(0,5) | reverse  %}
        <div class="card comment">
          <div class="author">
            {% if comment.CreatedUser.avatar == null  %}
              <img src="/pictures/avatar_defaut.jpg"> 
            {% else %}
              <img src="/pictures/avatars/{{ comment.CreatedUser.avatar }}"> 
            {% endif %}
            <strong>{{ comment.CreatedUser.pseudo }}</strong>
          </div>
          <div class="content">
            <p>{{ comment.content}}</p>
          </div>
          <div class="date">
            <small>{{ comment.createdAte | date('d/m/Y')}}</small>
          </div>
        </div>
      {% endfor %}  
      {% if trick.comments | length > 5 %}
          <a href="#comments" class="btn btn-primary">Lire tous les commentaires</a>
      {% endif %}    
    </div>



    <div id="delete{{trick.slug}}" class="overlay">
      <div class="popup">
        <h3>Suprimer le trick {{trick.name}} </h3>

        <div class="content">
          Si vous souhaitez supprimer le trick, tous les medias (photo et vidéo) et les commentaires vont être supprimer aussi
        </div>
          <a class="btn btn-danger" href="{{ path('deleteTrick', {'slug': trick.slug}) }}">
              Oui ! Je ne peux plus le voir ! 
          </a>
          <a class="btn btn-success" href="#">
              En faite... non.
          </a>
      </div>
    </div>
    <div id="media" class="overlay">
      <div class="popup">
        <h3>Que souhaitez-vous ajouter comme média ?  </h3>
          <a class="btn btn-danger" href="{{ path('addPhoto', {'slug': trick.slug}) }}">
              Ajouter une photo
          </a>
          <a class="btn btn-danger" href="{{ path('addVideo', {'slug': trick.slug}) }}">
              Ajouter une video
          </a>
          <a class="btn btn-success" href="#">
              En faite... non.
          </a>
      </div>
    </div>

    <div id="comments" class="overlay commentover">
      <div class="popup">
        <a class="close" href="#">
          <svg xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" width="30px" height="30px" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve"><g id="Page-1" sketch:type="MSPage"><g id="Button-circle-delete" transform="translate(1.000000, 1.000000)" sketch:type="MSLayerGroup"><circle id="Oval" sketch:type="MSShapeGroup" fill="none" stroke="#6B6C6E" stroke-width="2" cx="31" cy="31" r="31"></circle><path id="Shape" sketch:type="MSShapeGroup" fill="none" stroke="#6B6C6E" stroke-width="2" stroke-linejoin="round" d="    M43.5,38.1L36.4,31l7.1-7.1l-5.7-5.6l-7.1,7l-7-7L18,23.9l7.1,7.1L18,38.1l5.7,5.6l7-7l7.1,7L43.5,38.1z"/><path id="Shape_1_" sketch:type="MSShapeGroup" fill="none" stroke="#6B6C6E" stroke-width="2" d="M31,57C16.6,57,5,45.4,5,31"/><path id="Shape_2_" sketch:type="MSShapeGroup" fill="none" stroke="#6B6C6E" stroke-width="2" d="M31,5c14.4,0,26,11.6,26,26"/></g></g></svg>
        </a>     
        <div class="card comments">
          <h5>{{trick.comments | length }} commentaires</h5>           
          {% for comment in trick.comments | reverse %}
            <div class="card comment">
              <div class="author">
                {% if comment.CreatedUser.avatar == null  %}
                  <img src="/pictures/avatar_defaut.jpg"> 
                {% else %}
                  <img src="/pictures/avatars/{{ comment.CreatedUser.avatar }}"> 
                {% endif %}
                <strong>{{ comment.CreatedUser.pseudo }}</strong>
              </div>
              <div class="content">
                <p>{{ comment.content}}</p>
              </div>
              <div class="date">
                <small>{{ comment.createdAte | date('d/m/Y')}}</small>
              </div>
            </div>
          {% endfor %}  
        </div>
      </div>
    </div>
    
  </section>
{% endblock %}
